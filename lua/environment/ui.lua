local env = {}

function env.load_scheme(scheme, opts)
  opts = opts or {}
  local cs_has_lua, csmod = pcall(require, scheme)
  local load_ok, load_res
  if cs_has_lua then
    load_ok, load_res = pcall(csmod.load)
  end
  if not load_ok then
    if not opts.suppress_warning then
      require("funsak.lazy").warn(
        ("Could not load scheme using lua: %s\nmsg: %s\nAttempting to load using vim"):format(
          scheme,
          load_res
        )
      )
    end
    local vload_ok, vload_res =
      pcall(vim.cmd, ("colorscheme %s"):format(scheme))
    if not vload_ok then
      if not opts.suppress_warning then
        require("funsak.lazy").warn(
          ("Could not load scheme using vim fallback: %s\nmsg: %s\nAttempting to load using vim"):format(
            scheme,
            vload_res
          )
        )
      end
    end
  end
end

local function configer(plugin, op)
  op = op or {}
  op.hooks = op.hooks or {}
  return function(plg, opts)
    if op.hooks.before then
      op.hooks.before(plg, opts)
    end
    require(plugin).setup(opts)
    if op.hooks.after then
      op.hooks.after(plg, opts)
    end
  end
end

local environment_def_scheme = os.getenv("NIGHTOWL_COLORSCHEME")
env.colorscheme = {
  light = environment_def_scheme or "dawnfox",
  dark = environment_def_scheme or "kanagawa",
}

-- UI: Borders
-- ===========
-- Spec is that the main border should be shadow. We want this to apply to all
-- borders that are not made by mason or lazy, the package management tools.
-- Those receive the alt border. An accent border is also reserved for cases
-- when the main border is not appropriately readable, typically because the
-- window size is small.
env.borders = {
  main = "shadow",
  alt = "solid",
  main_accent = "single",
  telescope = { "â•", "â”†", "â•", "â”†", "â•’", "â••", "â•›", "â•˜" },
}

env.telescope = {
  theme = "ivy",
}

env.ft_ignore_list = {
  "oil",
  "Outline",
  "dashboard",
  "fzf",
  "trouble",
  "toggleterm",
  "outline",
  "qf",
  "TelescopePrompt",
  "Telescope",
  "tsplayground",
  "spectre_panel",
  "undotree",
  "undotreeDiff",
  "neo-tree",
  "Lazy",
  "dropbar_menu",
  "noice",
  "nnn",
  "prompt",
  "broot",
  "gundo",
  "NvimTree",
  "spaceport",
  "alpha",
}

env.ft_ignore_list_alt = vim.iter(env.ft_ignore_list):fold({}, function(t, v)
  return vim.tbl_deep_extend("force", t, { [v] = true })
end)

-- >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
-- Lualine: icons and other themes
-- <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

env.icons = {
  actions = {
    quickfix = "ó±”",
    refactor = "ó±Œ",
    source = "ó°¿¨",
    combined = "ó°´–", -- used when combine is set to true or as a fallback when there is no action kind
  },
  mason = {
    package = {
      installed = "ó±§˜",
      pending = "ó°—",
      uninstalled = "ó±§™",
    },
  },
  lualine = {
    mode = {
      ["NORMAL"] = "ó°©· ",
      ["INSERT"] = "ó°Ÿµ ",
      ["VISUAL"] = "ó° ¡ ",
      ["REPLACE"] = "î¬½ ",
      ["O-PENDING"] = "ó±–² ",
      ["BLOCK"] = "ó°™Ÿ ",
      ["LINE"] = "ó°˜¤ ",
      ["EX"] = "ó±Œ ",
      ["TERMINAL"] = "ï’µ ",
      ["COMMAND"] = "îž– ",
      ["SHELL"] = "ï’µ ",
      ["CONFIRM"] = "ó±”³ ",
    },
  },
  kinds = {
    Array = "ó°…ª ",
    Boolean = "îª ",
    CaseStatement = "ó°š” ",
    Class = "î­› ",
    Codeium = "ó°†¨ ",
    Color = "ó± “ ",
    Control = "î©¨ ",
    Collapsed = "ó°˜¤ ",
    Constant = "ó°³„ ",
    Constructor = "îŠ„ ",
    Copilot = "ï’¸ ",
    Enum = "îª• ",
    EnumMember = "î­ž ",
    Event = "îª† ",
    Field = "ó°“¼ ",
    File = "ó°ˆ¤ ",
    Folder = "ó°‰– ",
    Function = "ó°¡± ",
    Interface = "ó°¸» ",
    Key = "ó°·– ",
    Keyword = "î­¢ ",
    Method = "ó°¡± ",
    Module = "ï’‡ ",
    Namespace = "ï« ",
    Null = "ó°’… ",
    Number = "ó°Ž  ",
    Object = "ó°®„ ",
    Operator = "î­¤ ",
    Package = "î¬© ",
    Property = "ó°“½ ",
    Reference = "ó°®³ ",
    Snippet = "ó±‚• ",
    String = "î® ",
    Struct = "ï‘² ",
    TabNine = "ó±¤¬ ",
    Text = "ó°ª¸ ",
    TypeParameter = "î®— ",
    Unit = "îª– ",
    Value = "îª“ ",
    Variable = "îªˆ ",
  },
  diagnostic = {
    Error = "ó°³¦ ",
    Warn = "ó±‡ ",
    Hint = "ó°³§ ",
    Info = "ó°³¤ ",
  },
  modifications = {
    modified = "ó°·‰ ",
    readonly = "ó±€° ",
    unnamed = "ó±”˜ ",
    newfile = "ó±ªž ",
  },
  gitdiff = {
    added = "ó°œ„ ",
    removed = "ó°›² ",
    modified = "ó°­ ",
  },
  misc = {
    Ok = "ó°„µ ",
  },
  braille = {
    "â €",
    "â ",
    "â  ",
    "â °",
    "â¡€",
    "â¡",
    "â¡ ",
    "â¡°",
    "â¢€",
    "â¢",
    "â¢ ",
    "â¢°",
    "â£€",
    "â£",
    "â£ ",
    "â£°",
    "â ",
    "â ‘",
    "â ¡",
    "â ±",
    "â¡",
    "â¡‘",
    "â¡¡",
    "â¡±",
    "â¢",
    "â¢‘",
    "â¢¡",
    "â¢±",
    "â£",
    "â£‘",
    "â£¡",
    "â£±",
    "â ‚",
    "â ’",
    "â ¢",
    "â ²",
    "â¡‚",
    "â¡’",
    "â¡¢",
    "â¡²",
    "â¢‚",
    "â¢’",
    "â¢¢",
    "â¢²",
    "â£‚",
    "â£’",
    "â£¢",
    "â£²",
    "â ƒ",
    "â “",
    "â £",
    "â ³",
    "â¡ƒ",
    "â¡“",
    "â¡£",
    "â¡³",
    "â¢ƒ",
    "â¢“",
    "â¢£",
    "â¢³",
    "â£ƒ",
    "â£“",
    "â££",
    "â£³",
    "â „",
    "â ”",
    "â ¤",
    "â ´",
    "â¡„",
    "â¡”",
    "â¡¤",
    "â¡´",
    "â¢„",
    "â¢”",
    "â¢¤",
    "â¢´",
    "â£„",
    "â£”",
    "â£¤",
    "â£´",
    "â …",
    "â •",
    "â ¥",
    "â µ",
    "â¡…",
    "â¡•",
    "â¡¥",
    "â¡µ",
    "â¢…",
    "â¢•",
    "â¢¥",
    "â¢µ",
    "â£…",
    "â£•",
    "â£¥",
    "â£µ",
    "â †",
    "â –",
    "â ¦",
    "â ¶",
    "â¡†",
    "â¡–",
    "â¡¦",
    "â¡¶",
    "â¢†",
    "â¢–",
    "â¢¦",
    "â¢¶",
    "â£†",
    "â£–",
    "â£¦",
    "â£¶",
    "â ‡",
    "â —",
    "â §",
    "â ·",
    "â¡‡",
    "â¡—",
    "â¡§",
    "â¡·",
    "â¢‡",
    "â¢—",
    "â¢§",
    "â¢·",
    "â£‡",
    "â£—",
    "â£§",
    "â£·",
    "â ˆ",
    "â ˜",
    "â ¨",
    "â ¸",
    "â¡ˆ",
    "â¡˜",
    "â¡¨",
    "â¡¸",
    "â¢ˆ",
    "â¢˜",
    "â¢¨",
    "â¢¸",
    "â£ˆ",
    "â£˜",
    "â£¨",
    "â£¸",
    "â ‰",
    "â ™",
    "â ©",
    "â ¹",
    "â¡‰",
    "â¡™",
    "â¡©",
    "â¡¹",
    "â¢‰",
    "â¢™",
    "â¢©",
    "â¢¹",
    "â£‰",
    "â£™",
    "â£©",
    "â£¹",
    "â Š",
    "â š",
    "â ª",
    "â º",
    "â¡Š",
    "â¡š",
    "â¡ª",
    "â¡º",
    "â¢Š",
    "â¢š",
    "â¢ª",
    "â¢º",
    "â£Š",
    "â£š",
    "â£ª",
    "â£º",
    "â ‹",
    "â ›",
    "â «",
    "â »",
    "â¡‹",
    "â¡›",
    "â¡«",
    "â¡»",
    "â¢‹",
    "â¢›",
    "â¢«",
    "â¢»",
    "â£‹",
    "â£›",
    "â£«",
    "â£»",
    "â Œ",
    "â œ",
    "â ¬",
    "â ¼",
    "â¡Œ",
    "â¡œ",
    "â¡¬",
    "â¡¼",
    "â¢Œ",
    "â¢œ",
    "â¢¬",
    "â¢¼",
    "â£Œ",
    "â£œ",
    "â£¬",
    "â£¼",
    "â ",
    "â ",
    "â ­",
    "â ½",
    "â¡",
    "â¡",
    "â¡­",
    "â¡½",
    "â¢",
    "â¢",
    "â¢­",
    "â¢½",
    "â£",
    "â£",
    "â£­",
    "â£½",
    "â Ž",
    "â ž",
    "â ®",
    "â ¾",
    "â¡Ž",
    "â¡ž",
    "â¡®",
    "â¡¾",
    "â¢Ž",
    "â¢ž",
    "â¢®",
    "â¢¾",
    "â£Ž",
    "â£ž",
    "â£®",
    "â£¾",
    "â ",
    "â Ÿ",
    "â ¯",
    "â ¿",
    "â¡",
    "â¡Ÿ",
    "â¡¯",
    "â¡¿",
    "â¢",
    "â¢Ÿ",
    "â¢¯",
    "â¢¿",
    "â£",
    "â£Ÿ",
    "â£¯",
    "â£¿",
  },
  playing_cards = {
    "ðŸ‚ ",
    "ðŸ‚¡",
    "ðŸ‚¢",
    "ðŸ‚£",
    "ðŸ‚¤",
    "ðŸ‚¥",
    "ðŸ‚¦",
    "ðŸ‚§",
    "ðŸ‚¨",
    "ðŸ‚©",
    "ðŸ‚ª",
    "ðŸ‚«",
    "ðŸ‚¬",
    "ðŸ‚­",
    "ðŸ‚®",
    "ðŸ‚±",
    "ðŸ‚²",
    "ðŸ‚³",
    "ðŸ‚´",
    "ðŸ‚µ",
    "ðŸ‚¶",
    "ðŸ‚·",
    "ðŸ‚¸",
    "ðŸ‚¹",
    "ðŸ‚º",
    "ðŸ‚»",
    "ðŸ‚¼",
    "ðŸ‚½",
    "ðŸ‚¾",
    "ðŸ‚¿",
    "ðŸƒ",
    "ðŸƒ‚",
    "ðŸƒƒ",
    "ðŸƒ„",
    "ðŸƒ…",
    "ðŸƒ†",
    "ðŸƒ‡",
    "ðŸƒˆ",
    "ðŸƒ‰",
    "ðŸƒŠ",
    "ðŸƒ‹",
    "ðŸƒŒ",
    "ðŸƒ",
    "ðŸƒŽ",
    "ðŸƒ",
    "ðŸƒ‘",
    "ðŸƒ’",
    "ðŸƒ“",
    "ðŸƒ”",
    "ðŸƒ•",
    "ðŸƒ–",
    "ðŸƒ—",
    "ðŸƒ˜",
    "ðŸƒ™",
    "ðŸƒš",
    "ðŸƒ›",
    "ðŸƒœ",
    "ðŸƒ",
    "ðŸƒž",
    "ðŸƒŸ",
  },
  dominoes = {
    "ðŸ¤",
    "ðŸ°",
    "ðŸ‚€",
    "ðŸ‚",
    "ðŸ¥",
    "ðŸ±",
    "ðŸ‚",
    "ðŸ‚‘",
    "ðŸ¦",
    "ðŸ²",
    "ðŸ‚‚",
    "ðŸ‚’",
    "ðŸ§",
    "ðŸ³",
    "ðŸ‚ƒ",
    "ðŸ‚“",
    "ðŸ¨",
    "ðŸ´",
    "ðŸ‚„",
    "ðŸ©",
    "ðŸµ",
    "ðŸ‚…",
    "ðŸª",
    "ðŸ¶",
    "ðŸ‚†",
    "ðŸ«",
    "ðŸ·",
    "ðŸ‚‡",
    "ðŸ¬",
    "ðŸ¸",
    "ðŸ‚ˆ",
    "ðŸ­",
    "ðŸ¹",
    "ðŸ‚‰",
    "ðŸ®",
    "ðŸº",
    "ðŸ‚Š",
    "ðŸ¯",
    "ðŸ»",
    "ðŸ‚‹",
    "ðŸ¼",
    "ðŸ‚Œ",
    "ðŸ½",
    "ðŸ‚",
    "ðŸ¾",
    "ðŸ‚Ž",
    "ðŸ¿",
    "ðŸ‚",
  },
}
env.icons.cursorsigns = {
  head = env.icons.dominoes,
  body = env.icons.braille,
  tail = env.icons.braille,
}

env.padding = {
  noice = {
    main = { 2, 3 },
    small = { 1, 2 },
    large = { 3, 4 },
  },
}

-- should probably go into a different file
env.oil = {
  init_columns = "succinct",
  columns = {
    extended = {
      "icon",
      "type",
      "permissions",
      "birthtime",
      "atime",
      "mtime",
      "ctime",
      "size",
    },
    succinct = {
      "icon",
      "type",
      "ctime",
      "size",
    },
  },
}

env.column_rulers = { "+1", "+20" }

env.norg = {}
env.norg.icons = {
  todo = {
    cancelled = { icon = "ó°œº" },
    pending = { icon = "ó±…¤" },
    on_hold = { icon = "ó°µž" },
    recurring = { icon = "ó°‘–" },
    uncertain = { icon = "ó±”¢" },
    done = { icon = "ó°¡•" },
    undone = { icon = " " },
    urgent = { icon = "î©¬" },
  },
}

env.icons.norg = {
  todo = {
    cancelled = { icon = "ó°œº" },
    pending = { icon = "ó±…¤" },
    on_hold = { icon = "ó°µž" },
    recurring = { icon = "ó°‘–" },
    uncertain = { icon = "ó±”¢" },
    done = { icon = "ó°¡•" },
    undone = { icon = " " },
    urgent = { icon = "î©¬" },
  },
}

return env
